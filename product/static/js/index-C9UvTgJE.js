var _=(t,e,n)=>new Promise((a,d)=>{var o=h=>{try{r(n.next(h))}catch(y){d(y)}},s=h=>{try{r(n.throw(h))}catch(y){d(y)}},r=h=>h.done?a(h.value):Promise.resolve(h.value).then(o,s);r((n=n.apply(t,e)).next())});import{aP as he,a as se,aQ as Oe,L as Fe,V as Ne,d as ie,P as ne,J as Q,a7 as Ce,T as Ke,a1 as te,r as T,aR as ce,aS as qe,aT as Pe,a8 as Re,aa as je,a3 as I,W as re,aU as He,ac as R,p as Y,aG as fe,o as w,c as H,b as pe,q as B,w as b,aM as Ue,z as M,S as F,v as j,e as v,X as Ve,F as we,x as xe,ae as Se,ag as _e,D as We,aV as me,m as Ae,aW as Ye,aX as Je,ao as q,aJ as Qe,ad as Xe,K as Ge,aY as Ze,t as L,a5 as et,k as tt,i as P,aZ as nt,n as at,u as g,E as W,h as O,s as ve}from"./index-CzvhIu7P.js";import{s as ot,c as dt,E as st,d as rt,e as it,u as lt}from"./role-O-svaULO.js";import{b as ct}from"./menu-BItduFeL.js";import{e as ut,E as ht,a as ue,b as G,c as ft,d as pt}from"./index-rrQgjpCY.js";import{E as Z,a as be}from"./index-KErNApeX.js";import{E as Ee}from"./index-BDDkVizw.js";const J="$treeNodeId",De=function(t,e){!e||e[J]||Object.defineProperty(e,J,{value:t.id,enumerable:!1,configurable:!1,writable:!1})},ke=function(t,e){return t?e[t]:e[J]},ge=(t,e,n)=>{const a=t.value.currentNode;n();const d=t.value.currentNode;a!==d&&e("current-change",d?d.data:null,d)},ye=t=>{let e=!0,n=!0,a=!0;for(let d=0,o=t.length;d<o;d++){const s=t[d];(s.checked!==!0||s.indeterminate)&&(e=!1,s.disabled||(a=!1)),(s.checked!==!1||s.indeterminate)&&(n=!1)}return{all:e,none:n,allWithoutDisable:a,half:!e&&!n}},ee=function(t){if(t.childNodes.length===0||t.loading)return;const{all:e,none:n,half:a}=ye(t.childNodes);e?(t.checked=!0,t.indeterminate=!1):a?(t.checked=!1,t.indeterminate=!0):n&&(t.checked=!1,t.indeterminate=!1);const d=t.parent;!d||d.level===0||t.store.checkStrictly||ee(d)},de=function(t,e){const n=t.store.props,a=t.data||{},d=n[e];if(typeof d=="function")return d(a,t);if(typeof d=="string")return a[d];if(typeof d=="undefined"){const o=a[e];return o===void 0?"":o}};let gt=0;class U{constructor(e){this.id=gt++,this.text=null,this.checked=!1,this.indeterminate=!1,this.data=null,this.expanded=!1,this.parent=null,this.visible=!0,this.isCurrent=!1,this.canFocus=!1;for(const n in e)he(e,n)&&(this[n]=e[n]);this.level=0,this.loaded=!1,this.childNodes=[],this.loading=!1,this.parent&&(this.level=this.parent.level+1)}initialize(){const e=this.store;if(!e)throw new Error("[Node]store is required!");e.registerNode(this);const n=e.props;if(n&&typeof n.isLeaf!="undefined"){const o=de(this,"isLeaf");typeof o=="boolean"&&(this.isLeafByUser=o)}if(e.lazy!==!0&&this.data?(this.setData(this.data),e.defaultExpandAll&&(this.expanded=!0,this.canFocus=!0)):this.level>0&&e.lazy&&e.defaultExpandAll&&!this.isLeafByUser&&this.expand(),Array.isArray(this.data)||De(this,this.data),!this.data)return;const a=e.defaultExpandedKeys,d=e.key;d&&a&&a.includes(this.key)&&this.expand(null,e.autoExpandParent),d&&e.currentNodeKey!==void 0&&this.key===e.currentNodeKey&&(e.currentNode=this,e.currentNode.isCurrent=!0),e.lazy&&e._initDefaultCheckedNode(this),this.updateLeafState(),this.parent&&(this.level===1||this.parent.expanded===!0)&&(this.canFocus=!0)}setData(e){Array.isArray(e)||De(this,e),this.data=e,this.childNodes=[];let n;this.level===0&&Array.isArray(this.data)?n=this.data:n=de(this,"children")||[];for(let a=0,d=n.length;a<d;a++)this.insertChild({data:n[a]})}get label(){return de(this,"label")}get key(){const e=this.store.key;return this.data?this.data[e]:null}get disabled(){return de(this,"disabled")}get nextSibling(){const e=this.parent;if(e){const n=e.childNodes.indexOf(this);if(n>-1)return e.childNodes[n+1]}return null}get previousSibling(){const e=this.parent;if(e){const n=e.childNodes.indexOf(this);if(n>-1)return n>0?e.childNodes[n-1]:null}return null}contains(e,n=!0){return(this.childNodes||[]).some(a=>a===e||n&&a.contains(e))}remove(){const e=this.parent;e&&e.removeChild(this)}insertChild(e,n,a){if(!e)throw new Error("InsertChild error: child is required.");if(!(e instanceof U)){if(!a){const d=this.getChildren(!0);d.includes(e.data)||(typeof n=="undefined"||n<0?d.push(e.data):d.splice(n,0,e.data))}Object.assign(e,{parent:this,store:this.store}),e=se(new U(e)),e instanceof U&&e.initialize()}e.level=this.level+1,typeof n=="undefined"||n<0?this.childNodes.push(e):this.childNodes.splice(n,0,e),this.updateLeafState()}insertBefore(e,n){let a;n&&(a=this.childNodes.indexOf(n)),this.insertChild(e,a)}insertAfter(e,n){let a;n&&(a=this.childNodes.indexOf(n),a!==-1&&(a+=1)),this.insertChild(e,a)}removeChild(e){const n=this.getChildren()||[],a=n.indexOf(e.data);a>-1&&n.splice(a,1);const d=this.childNodes.indexOf(e);d>-1&&(this.store&&this.store.deregisterNode(e),e.parent=null,this.childNodes.splice(d,1)),this.updateLeafState()}removeChildByData(e){let n=null;for(let a=0;a<this.childNodes.length;a++)if(this.childNodes[a].data===e){n=this.childNodes[a];break}n&&this.removeChild(n)}expand(e,n){const a=()=>{if(n){let d=this.parent;for(;d.level>0;)d.expanded=!0,d=d.parent}this.expanded=!0,e&&e(),this.childNodes.forEach(d=>{d.canFocus=!0})};this.shouldLoadData()?this.loadData(d=>{Array.isArray(d)&&(this.checked?this.setChecked(!0,!0):this.store.checkStrictly||ee(this),a())}):a()}doCreateChildren(e,n={}){e.forEach(a=>{this.insertChild(Object.assign({data:a},n),void 0,!0)})}collapse(){this.expanded=!1,this.childNodes.forEach(e=>{e.canFocus=!1})}shouldLoadData(){return this.store.lazy===!0&&this.store.load&&!this.loaded}updateLeafState(){if(this.store.lazy===!0&&this.loaded!==!0&&typeof this.isLeafByUser!="undefined"){this.isLeaf=this.isLeafByUser;return}const e=this.childNodes;if(!this.store.lazy||this.store.lazy===!0&&this.loaded===!0){this.isLeaf=!e||e.length===0;return}this.isLeaf=!1}setChecked(e,n,a,d){if(this.indeterminate=e==="half",this.checked=e===!0,this.store.checkStrictly)return;if(!(this.shouldLoadData()&&!this.store.checkDescendants)){const{all:s,allWithoutDisable:r}=ye(this.childNodes);!this.isLeaf&&!s&&r&&(this.checked=!1,e=!1);const h=()=>{if(n){const y=this.childNodes;for(let f=0,N=y.length;f<N;f++){const C=y[f];d=d||e!==!1;const E=C.disabled?C.checked:d;C.setChecked(E,n,!0,d)}const{half:l,all:c}=ye(y);c||(this.checked=c,this.indeterminate=l)}};if(this.shouldLoadData()){this.loadData(()=>{h(),ee(this)},{checked:e!==!1});return}else h()}const o=this.parent;!o||o.level===0||a||ee(o)}getChildren(e=!1){if(this.level===0)return this.data;const n=this.data;if(!n)return null;const a=this.store.props;let d="children";return a&&(d=a.children||"children"),n[d]===void 0&&(n[d]=null),e&&!n[d]&&(n[d]=[]),n[d]}updateChildren(){const e=this.getChildren()||[],n=this.childNodes.map(o=>o.data),a={},d=[];e.forEach((o,s)=>{const r=o[J];!!r&&n.findIndex(y=>y[J]===r)>=0?a[r]={index:s,data:o}:d.push({index:s,data:o})}),this.store.lazy||n.forEach(o=>{a[o[J]]||this.removeChildByData(o)}),d.forEach(({index:o,data:s})=>{this.insertChild({data:s},o)}),this.updateLeafState()}loadData(e,n={}){if(this.store.lazy===!0&&this.store.load&&!this.loaded&&(!this.loading||Object.keys(n).length)){this.loading=!0;const a=o=>{this.childNodes=[],this.doCreateChildren(o,n),this.loaded=!0,this.loading=!1,this.updateLeafState(),e&&e.call(this,o)},d=()=>{this.loading=!1};this.store.load(this,a,d)}else e&&e.call(this)}eachNode(e){const n=[this];for(;n.length;){const a=n.shift();n.unshift(...a.childNodes),e(a)}}reInitChecked(){this.store.checkStrictly||ee(this)}}class yt{constructor(e){this.currentNode=null,this.currentNodeKey=null;for(const n in e)he(e,n)&&(this[n]=e[n]);this.nodesMap={}}initialize(){if(this.root=new U({data:this.data,store:this}),this.root.initialize(),this.lazy&&this.load){const e=this.load;e(this.root,n=>{this.root.doCreateChildren(n),this._initDefaultCheckedNodes()})}else this._initDefaultCheckedNodes()}filter(e){const n=this.filterNodeMethod,a=this.lazy,d=function(o){const s=o.root?o.root.childNodes:o.childNodes;if(s.forEach(r=>{r.visible=n.call(r,e,r.data,r),d(r)}),!o.visible&&s.length){let r=!0;r=!s.some(h=>h.visible),o.root?o.root.visible=r===!1:o.visible=r===!1}e&&o.visible&&!o.isLeaf&&(!a||o.loaded)&&o.expand()};d(this)}setData(e){e!==this.root.data?(this.nodesMap={},this.root.setData(e),this._initDefaultCheckedNodes()):this.root.updateChildren()}getNode(e){if(e instanceof U)return e;const n=Oe(e)?ke(this.key,e):e;return this.nodesMap[n]||null}insertBefore(e,n){const a=this.getNode(n);a.parent.insertBefore({data:e},a)}insertAfter(e,n){const a=this.getNode(n);a.parent.insertAfter({data:e},a)}remove(e){const n=this.getNode(e);n&&n.parent&&(n===this.currentNode&&(this.currentNode=null),n.parent.removeChild(n))}append(e,n){const a=Fe(n)?this.root:this.getNode(n);a&&a.insertChild({data:e})}_initDefaultCheckedNodes(){const e=this.defaultCheckedKeys||[],n=this.nodesMap;e.forEach(a=>{const d=n[a];d&&d.setChecked(!0,!this.checkStrictly)})}_initDefaultCheckedNode(e){(this.defaultCheckedKeys||[]).includes(e.key)&&e.setChecked(!0,!this.checkStrictly)}setDefaultCheckedKey(e){e!==this.defaultCheckedKeys&&(this.defaultCheckedKeys=e,this._initDefaultCheckedNodes())}registerNode(e){const n=this.key;!e||!e.data||(n?e.key!==void 0&&(this.nodesMap[e.key]=e):this.nodesMap[e.id]=e)}deregisterNode(e){!this.key||!e||!e.data||(e.childNodes.forEach(a=>{this.deregisterNode(a)}),delete this.nodesMap[e.key])}getCheckedNodes(e=!1,n=!1){const a=[],d=function(o){(o.root?o.root.childNodes:o.childNodes).forEach(r=>{(r.checked||n&&r.indeterminate)&&(!e||e&&r.isLeaf)&&a.push(r.data),d(r)})};return d(this),a}getCheckedKeys(e=!1){return this.getCheckedNodes(e).map(n=>(n||{})[this.key])}getHalfCheckedNodes(){const e=[],n=function(a){(a.root?a.root.childNodes:a.childNodes).forEach(o=>{o.indeterminate&&e.push(o.data),n(o)})};return n(this),e}getHalfCheckedKeys(){return this.getHalfCheckedNodes().map(e=>(e||{})[this.key])}_getAllNodes(){const e=[],n=this.nodesMap;for(const a in n)he(n,a)&&e.push(n[a]);return e}updateChildren(e,n){const a=this.nodesMap[e];if(!a)return;const d=a.childNodes;for(let o=d.length-1;o>=0;o--){const s=d[o];this.remove(s.data)}for(let o=0,s=n.length;o<s;o++){const r=n[o];this.append(r,a.data)}}_setCheckedKeys(e,n=!1,a){const d=this._getAllNodes().sort((h,y)=>h.level-y.level),o=Object.create(null),s=Object.keys(a);d.forEach(h=>h.setChecked(!1,!1));const r=h=>{h.childNodes.forEach(y=>{var l;o[y.data[e]]=!0,(l=y.childNodes)!=null&&l.length&&r(y)})};for(let h=0,y=d.length;h<y;h++){const l=d[h],c=l.data[e].toString();if(!s.includes(c)){l.checked&&!o[c]&&l.setChecked(!1,!1);continue}if(l.childNodes.length&&r(l),l.isLeaf||this.checkStrictly){l.setChecked(!0,!1);continue}if(l.setChecked(!0,!0),n){l.setChecked(!1,!1);const N=function(C){C.childNodes.forEach(u=>{u.isLeaf||u.setChecked(!1,!1),N(u)})};N(l)}}}setCheckedNodes(e,n=!1){const a=this.key,d={};e.forEach(o=>{d[(o||{})[a]]=!0}),this._setCheckedKeys(a,n,d)}setCheckedKeys(e,n=!1){this.defaultCheckedKeys=e;const a=this.key,d={};e.forEach(o=>{d[o]=!0}),this._setCheckedKeys(a,n,d)}setDefaultExpandedKeys(e){e=e||[],this.defaultExpandedKeys=e,e.forEach(n=>{const a=this.getNode(n);a&&a.expand(null,this.autoExpandParent)})}setChecked(e,n,a){const d=this.getNode(e);d&&d.setChecked(!!n,a)}getCurrentNode(){return this.currentNode}setCurrentNode(e){const n=this.currentNode;n&&(n.isCurrent=!1),this.currentNode=e,this.currentNode.isCurrent=!0}setUserCurrentNode(e,n=!0){const a=e[this.key],d=this.nodesMap[a];this.setCurrentNode(d),n&&this.currentNode.level>1&&this.currentNode.parent.expand(null,!0)}setCurrentNodeKey(e,n=!0){if(e==null){this.currentNode&&(this.currentNode.isCurrent=!1),this.currentNode=null;return}const a=this.getNode(e);a&&(this.setCurrentNode(a),n&&this.currentNode.level>1&&this.currentNode.parent.expand(null,!0))}}const Nt=ie({name:"ElTreeNodeContent",props:{node:{type:Object,required:!0},renderContent:Function},setup(t){const e=ne("tree"),n=Q("NodeInstance"),a=Q("RootTree");return()=>{const d=t.node,{data:o,store:s}=d;return t.renderContent?t.renderContent(Ce,{_self:n,node:d,data:o,store:s}):Ke(a.ctx.slots,"default",{node:d,data:o},()=>[Ce("span",{class:e.be("node","label")},[d.label])])}}});var kt=Ne(Nt,[["__file","tree-node-content.vue"]]);function Te(t){const e=Q("TreeNodeMap",null),n={treeNodeExpand:a=>{t.node!==a&&t.node.collapse()},children:[]};return e&&e.children.push(n),te("TreeNodeMap",n),{broadcastExpanded:a=>{if(t.accordion)for(const d of n.children)d.treeNodeExpand(a)}}}const Ie=Symbol("dragEvents");function Ct({props:t,ctx:e,el$:n,dropIndicator$:a,store:d}){const o=ne("tree"),s=T({showDropIndicator:!1,draggingNode:null,dropNode:null,allowDrop:!0,dropType:null});return te(Ie,{treeNodeDragStart:({event:l,treeNode:c})=>{if(typeof t.allowDrag=="function"&&!t.allowDrag(c.node))return l.preventDefault(),!1;l.dataTransfer.effectAllowed="move";try{l.dataTransfer.setData("text/plain","")}catch(f){}s.value.draggingNode=c,e.emit("node-drag-start",c.node,l)},treeNodeDragOver:({event:l,treeNode:c})=>{const f=c,N=s.value.dropNode;N&&N.node.id!==f.node.id&&ce(N.$el,o.is("drop-inner"));const C=s.value.draggingNode;if(!C||!f)return;let E=!0,u=!0,k=!0,S=!0;typeof t.allowDrop=="function"&&(E=t.allowDrop(C.node,f.node,"prev"),S=u=t.allowDrop(C.node,f.node,"inner"),k=t.allowDrop(C.node,f.node,"next")),l.dataTransfer.dropEffect=u||E||k?"move":"none",(E||u||k)&&(N==null?void 0:N.node.id)!==f.node.id&&(N&&e.emit("node-drag-leave",C.node,N.node,l),e.emit("node-drag-enter",C.node,f.node,l)),E||u||k?s.value.dropNode=f:s.value.dropNode=null,f.node.nextSibling===C.node&&(k=!1),f.node.previousSibling===C.node&&(E=!1),f.node.contains(C.node,!1)&&(u=!1),(C.node===f.node||C.node.contains(f.node))&&(E=!1,u=!1,k=!1);const D=f.$el.querySelector(`.${o.be("node","content")}`).getBoundingClientRect(),$=n.value.getBoundingClientRect();let A;const ae=E?u?.25:k?.45:1:-1,oe=k?u?.75:E?.55:0:1;let V=-9999;const p=l.clientY-D.top;p<D.height*ae?A="before":p>D.height*oe?A="after":u?A="inner":A="none";const K=f.$el.querySelector(`.${o.be("node","expand-icon")}`).getBoundingClientRect(),x=a.value;A==="before"?V=K.top-$.top:A==="after"&&(V=K.bottom-$.top),x.style.top=`${V}px`,x.style.left=`${K.right-$.left}px`,A==="inner"?qe(f.$el,o.is("drop-inner")):ce(f.$el,o.is("drop-inner")),s.value.showDropIndicator=A==="before"||A==="after",s.value.allowDrop=s.value.showDropIndicator||S,s.value.dropType=A,e.emit("node-drag-over",C.node,f.node,l)},treeNodeDragEnd:l=>{const{draggingNode:c,dropType:f,dropNode:N}=s.value;if(l.preventDefault(),l.dataTransfer&&(l.dataTransfer.dropEffect="move"),c&&N){const C={data:c.node.data};f!=="none"&&c.node.remove(),f==="before"?N.node.parent.insertBefore(C,N.node):f==="after"?N.node.parent.insertAfter(C,N.node):f==="inner"&&N.node.insertChild(C),f!=="none"&&(d.value.registerNode(C),d.value.key&&c.node.eachNode(E=>{var u;(u=d.value.nodesMap[E.data[d.value.key]])==null||u.setChecked(E.checked,!d.value.checkStrictly)})),ce(N.$el,o.is("drop-inner")),e.emit("node-drag-end",c.node,N.node,f,l),f!=="none"&&e.emit("node-drop",c.node,N.node,f,l)}c&&!N&&e.emit("node-drag-end",c.node,null,f,l),s.value.showDropIndicator=!1,s.value.draggingNode=null,s.value.dropNode=null,s.value.allowDrop=!0}}),{dragState:s}}const mt=ie({name:"ElTreeNode",components:{ElCollapseTransition:Pe,ElCheckbox:ut,NodeContent:kt,ElIcon:Re,Loading:je},props:{node:{type:U,default:()=>({})},props:{type:Object,default:()=>({})},accordion:Boolean,renderContent:Function,renderAfterExpand:Boolean,showCheckbox:{type:Boolean,default:!1}},emits:["node-expand"],setup(t,e){const n=ne("tree"),{broadcastExpanded:a}=Te(t),d=Q("RootTree"),o=T(!1),s=T(!1),r=T(null),h=T(null),y=T(null),l=Q(Ie),c=Se();te("NodeInstance",c),t.node.expanded&&(o.value=!0,s.value=!0);const f=d.props.props.children||"children";I(()=>{const p=t.node.data[f];return p&&[...p]},()=>{t.node.updateChildren()}),I(()=>t.node.indeterminate,p=>{E(t.node.checked,p)}),I(()=>t.node.checked,p=>{E(p,t.node.indeterminate)}),I(()=>t.node.childNodes.length,()=>t.node.reInitChecked()),I(()=>t.node.expanded,p=>{re(()=>o.value=p),p&&(s.value=!0)});const N=p=>ke(d.props.nodeKey,p.data),C=p=>{const K=t.props.class;if(!K)return{};let x;if(_e(K)){const{data:le}=p;x=K(le,p)}else x=K;return We(x)?{[x]:!0}:x},E=(p,K)=>{(r.value!==p||h.value!==K)&&d.ctx.emit("check-change",t.node.data,p,K),r.value=p,h.value=K},u=p=>{ge(d.store,d.ctx.emit,()=>d.store.value.setCurrentNode(t.node)),d.currentNode.value=t.node,d.props.expandOnClickNode&&S(),d.props.checkOnClickNode&&!t.node.disabled&&D(null,{target:{checked:!t.node.checked}}),d.ctx.emit("node-click",t.node.data,t.node,c,p)},k=p=>{d.instance.vnode.props.onNodeContextmenu&&(p.stopPropagation(),p.preventDefault()),d.ctx.emit("node-contextmenu",p,t.node.data,t.node,c)},S=()=>{t.node.isLeaf||(o.value?(d.ctx.emit("node-collapse",t.node.data,t.node,c),t.node.collapse()):t.node.expand(()=>{e.emit("node-expand",t.node.data,t.node,c)}))},D=(p,K)=>{t.node.setChecked(K.target.checked,!d.props.checkStrictly),re(()=>{const x=d.store.value;d.ctx.emit("check",t.node.data,{checkedNodes:x.getCheckedNodes(),checkedKeys:x.getCheckedKeys(),halfCheckedNodes:x.getHalfCheckedNodes(),halfCheckedKeys:x.getHalfCheckedKeys()})})};return{ns:n,node$:y,tree:d,expanded:o,childNodeRendered:s,oldChecked:r,oldIndeterminate:h,getNodeKey:N,getNodeClass:C,handleSelectChange:E,handleClick:u,handleContextMenu:k,handleExpandIconClick:S,handleCheckChange:D,handleChildNodeExpand:(p,K,x)=>{a(K),d.ctx.emit("node-expand",p,K,x)},handleDragStart:p=>{d.props.draggable&&l.treeNodeDragStart({event:p,treeNode:t})},handleDragOver:p=>{p.preventDefault(),d.props.draggable&&l.treeNodeDragOver({event:p,treeNode:{$el:y.value,node:t.node}})},handleDrop:p=>{p.preventDefault()},handleDragEnd:p=>{d.props.draggable&&l.treeNodeDragEnd(p)},CaretRight:He}}});function vt(t,e,n,a,d,o){const s=R("el-icon"),r=R("el-checkbox"),h=R("loading"),y=R("node-content"),l=R("el-tree-node"),c=R("el-collapse-transition");return Y((w(),H("div",{ref:"node$",class:M([t.ns.b("node"),t.ns.is("expanded",t.expanded),t.ns.is("current",t.node.isCurrent),t.ns.is("hidden",!t.node.visible),t.ns.is("focusable",!t.node.disabled),t.ns.is("checked",!t.node.disabled&&t.node.checked),t.getNodeClass(t.node)]),role:"treeitem",tabindex:"-1","aria-expanded":t.expanded,"aria-disabled":t.node.disabled,"aria-checked":t.node.checked,draggable:t.tree.props.draggable,"data-key":t.getNodeKey(t.node),onClick:F(t.handleClick,["stop"]),onContextmenu:t.handleContextMenu,onDragstart:F(t.handleDragStart,["stop"]),onDragover:F(t.handleDragOver,["stop"]),onDragend:F(t.handleDragEnd,["stop"]),onDrop:F(t.handleDrop,["stop"])},[pe("div",{class:M(t.ns.be("node","content")),style:Ve({paddingLeft:(t.node.level-1)*t.tree.props.indent+"px"})},[t.tree.props.icon||t.CaretRight?(w(),B(s,{key:0,class:M([t.ns.be("node","expand-icon"),t.ns.is("leaf",t.node.isLeaf),{expanded:!t.node.isLeaf&&t.expanded}]),onClick:F(t.handleExpandIconClick,["stop"])},{default:b(()=>[(w(),B(Ue(t.tree.props.icon||t.CaretRight)))]),_:1},8,["class","onClick"])):j("v-if",!0),t.showCheckbox?(w(),B(r,{key:1,"model-value":t.node.checked,indeterminate:t.node.indeterminate,disabled:!!t.node.disabled,onClick:F(()=>{},["stop"]),onChange:t.handleCheckChange},null,8,["model-value","indeterminate","disabled","onClick","onChange"])):j("v-if",!0),t.node.loading?(w(),B(s,{key:2,class:M([t.ns.be("node","loading-icon"),t.ns.is("loading")])},{default:b(()=>[v(h)]),_:1},8,["class"])):j("v-if",!0),v(y,{node:t.node,"render-content":t.renderContent},null,8,["node","render-content"])],6),v(c,null,{default:b(()=>[!t.renderAfterExpand||t.childNodeRendered?Y((w(),H("div",{key:0,class:M(t.ns.be("node","children")),role:"group","aria-expanded":t.expanded},[(w(!0),H(we,null,xe(t.node.childNodes,f=>(w(),B(l,{key:t.getNodeKey(f),"render-content":t.renderContent,"render-after-expand":t.renderAfterExpand,"show-checkbox":t.showCheckbox,node:f,accordion:t.accordion,props:t.props,onNodeExpand:t.handleChildNodeExpand},null,8,["render-content","render-after-expand","show-checkbox","node","accordion","props","onNodeExpand"]))),128))],10,["aria-expanded"])),[[fe,t.expanded]]):j("v-if",!0)]),_:1})],42,["aria-expanded","aria-disabled","aria-checked","draggable","data-key","onClick","onContextmenu","onDragstart","onDragover","onDragend","onDrop"])),[[fe,t.node.visible]])}var bt=Ne(mt,[["render",vt],["__file","tree-node.vue"]]);function Et({el$:t},e){const n=ne("tree"),a=me([]),d=me([]);Ae(()=>{s()}),Ye(()=>{a.value=Array.from(t.value.querySelectorAll("[role=treeitem]")),d.value=Array.from(t.value.querySelectorAll("input[type=checkbox]"))}),I(d,r=>{r.forEach(h=>{h.setAttribute("tabindex","-1")})}),Je(t,"keydown",r=>{const h=r.target;if(!h.className.includes(n.b("node")))return;const y=r.code;a.value=Array.from(t.value.querySelectorAll(`.${n.is("focusable")}[role=treeitem]`));const l=a.value.indexOf(h);let c;if([q.up,q.down].includes(y)){if(r.preventDefault(),y===q.up){c=l===-1?0:l!==0?l-1:a.value.length-1;const N=c;for(;!e.value.getNode(a.value[c].dataset.key).canFocus;){if(c--,c===N){c=-1;break}c<0&&(c=a.value.length-1)}}else{c=l===-1?0:l<a.value.length-1?l+1:0;const N=c;for(;!e.value.getNode(a.value[c].dataset.key).canFocus;){if(c++,c===N){c=-1;break}c>=a.value.length&&(c=0)}}c!==-1&&a.value[c].focus()}[q.left,q.right].includes(y)&&(r.preventDefault(),h.click());const f=h.querySelector('[type="checkbox"]');[q.enter,q.space].includes(y)&&f&&(r.preventDefault(),f.click())});const s=()=>{var r;a.value=Array.from(t.value.querySelectorAll(`.${n.is("focusable")}[role=treeitem]`)),d.value=Array.from(t.value.querySelectorAll("input[type=checkbox]"));const h=t.value.querySelectorAll(`.${n.is("checked")}[role=treeitem]`);if(h.length){h[0].setAttribute("tabindex","0");return}(r=a.value[0])==null||r.setAttribute("tabindex","0")}}const Dt=ie({name:"ElTree",components:{ElTreeNode:bt},props:{data:{type:Array,default:()=>[]},emptyText:{type:String},renderAfterExpand:{type:Boolean,default:!0},nodeKey:String,checkStrictly:Boolean,defaultExpandAll:Boolean,expandOnClickNode:{type:Boolean,default:!0},checkOnClickNode:Boolean,checkDescendants:{type:Boolean,default:!1},autoExpandParent:{type:Boolean,default:!0},defaultCheckedKeys:Array,defaultExpandedKeys:Array,currentNodeKey:[String,Number],renderContent:Function,showCheckbox:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},allowDrag:Function,allowDrop:Function,props:{type:Object,default:()=>({children:"children",label:"label",disabled:"disabled"})},lazy:{type:Boolean,default:!1},highlightCurrent:Boolean,load:Function,filterNodeMethod:Function,accordion:Boolean,indent:{type:Number,default:18},icon:{type:Qe}},emits:["check-change","current-change","node-click","node-contextmenu","node-collapse","node-expand","check","node-drag-start","node-drag-end","node-drop","node-drag-leave","node-drag-enter","node-drag-over"],setup(t,e){const{t:n}=Xe(),a=ne("tree"),d=Q(ot,null),o=T(new yt({key:t.nodeKey,data:t.data,lazy:t.lazy,props:t.props,load:t.load,currentNodeKey:t.currentNodeKey,checkStrictly:t.checkStrictly,checkDescendants:t.checkDescendants,defaultCheckedKeys:t.defaultCheckedKeys,defaultExpandedKeys:t.defaultExpandedKeys,autoExpandParent:t.autoExpandParent,defaultExpandAll:t.defaultExpandAll,filterNodeMethod:t.filterNodeMethod}));o.value.initialize();const s=T(o.value.root),r=T(null),h=T(null),y=T(null),{broadcastExpanded:l}=Te(t),{dragState:c}=Ct({props:t,ctx:e,el$:h,dropIndicator$:y,store:o});Et({el$:h},o);const f=Ge(()=>{const{childNodes:i}=s.value,m=d?d.hasFilteredOptions!==0:!1;return(!i||i.length===0||i.every(({visible:z})=>!z))&&!m});I(()=>t.currentNodeKey,i=>{o.value.setCurrentNodeKey(i)}),I(()=>t.defaultCheckedKeys,i=>{o.value.setDefaultCheckedKey(i)}),I(()=>t.defaultExpandedKeys,i=>{o.value.setDefaultExpandedKeys(i)}),I(()=>t.data,i=>{o.value.setData(i)},{deep:!0}),I(()=>t.checkStrictly,i=>{o.value.checkStrictly=i});const N=i=>{if(!t.filterNodeMethod)throw new Error("[Tree] filterNodeMethod is required when filter");o.value.filter(i)},C=i=>ke(t.nodeKey,i.data),E=i=>{if(!t.nodeKey)throw new Error("[Tree] nodeKey is required in getNodePath");const m=o.value.getNode(i);if(!m)return[];const z=[m.data];let X=m.parent;for(;X&&X!==s.value;)z.push(X.data),X=X.parent;return z.reverse()},u=(i,m)=>o.value.getCheckedNodes(i,m),k=i=>o.value.getCheckedKeys(i),S=()=>{const i=o.value.getCurrentNode();return i?i.data:null},D=()=>{if(!t.nodeKey)throw new Error("[Tree] nodeKey is required in getCurrentKey");const i=S();return i?i[t.nodeKey]:null},$=(i,m)=>{if(!t.nodeKey)throw new Error("[Tree] nodeKey is required in setCheckedNodes");o.value.setCheckedNodes(i,m)},A=(i,m)=>{if(!t.nodeKey)throw new Error("[Tree] nodeKey is required in setCheckedKeys");o.value.setCheckedKeys(i,m)},ae=(i,m,z)=>{o.value.setChecked(i,m,z)},oe=()=>o.value.getHalfCheckedNodes(),V=()=>o.value.getHalfCheckedKeys(),p=(i,m=!0)=>{if(!t.nodeKey)throw new Error("[Tree] nodeKey is required in setCurrentNode");ge(o,e.emit,()=>{l(i),o.value.setUserCurrentNode(i,m)})},K=(i,m=!0)=>{if(!t.nodeKey)throw new Error("[Tree] nodeKey is required in setCurrentKey");ge(o,e.emit,()=>{l(),o.value.setCurrentNodeKey(i,m)})},x=i=>o.value.getNode(i),le=i=>{o.value.remove(i)},Be=(i,m)=>{o.value.append(i,m)},Le=(i,m)=>{o.value.insertBefore(i,m)},Me=(i,m)=>{o.value.insertAfter(i,m)},$e=(i,m,z)=>{l(m),e.emit("node-expand",i,m,z)},ze=(i,m)=>{if(!t.nodeKey)throw new Error("[Tree] nodeKey is required in updateKeyChild");o.value.updateChildren(i,m)};return te("RootTree",{ctx:e,props:t,store:o,root:s,currentNode:r,instance:Se()}),te(Ze,void 0),{ns:a,store:o,root:s,currentNode:r,dragState:c,el$:h,dropIndicator$:y,isEmpty:f,filter:N,getNodeKey:C,getNodePath:E,getCheckedNodes:u,getCheckedKeys:k,getCurrentNode:S,getCurrentKey:D,setCheckedNodes:$,setCheckedKeys:A,setChecked:ae,getHalfCheckedNodes:oe,getHalfCheckedKeys:V,setCurrentNode:p,setCurrentKey:K,t:n,getNode:x,remove:le,append:Be,insertBefore:Le,insertAfter:Me,handleNodeExpand:$e,updateKeyChildren:ze}}});function Kt(t,e,n,a,d,o){const s=R("el-tree-node");return w(),H("div",{ref:"el$",class:M([t.ns.b(),t.ns.is("dragging",!!t.dragState.draggingNode),t.ns.is("drop-not-allow",!t.dragState.allowDrop),t.ns.is("drop-inner",t.dragState.dropType==="inner"),{[t.ns.m("highlight-current")]:t.highlightCurrent}]),role:"tree"},[(w(!0),H(we,null,xe(t.root.childNodes,r=>(w(),B(s,{key:t.getNodeKey(r),node:r,props:t.props,accordion:t.accordion,"render-after-expand":t.renderAfterExpand,"show-checkbox":t.showCheckbox,"render-content":t.renderContent,onNodeExpand:t.handleNodeExpand},null,8,["node","props","accordion","render-after-expand","show-checkbox","render-content","onNodeExpand"]))),128)),t.isEmpty?(w(),H("div",{key:0,class:M(t.ns.e("empty-block"))},[Ke(t.$slots,"empty",{},()=>{var r;return[pe("span",{class:M(t.ns.e("empty-text"))},L((r=t.emptyText)!=null?r:t.t("el.tree.emptyText")),3)]})],2)):j("v-if",!0),Y(pe("div",{ref:"dropIndicator$",class:M(t.ns.e("drop-indicator"))},null,2),[[fe,t.dragState.showDropIndicator]])],2)}var wt=Ne(Dt,[["render",Kt],["__file","tree.vue"]]);const xt=et(wt),St={class:"container"},zt=ie({name:"systemMenu",__name:"index",setup(t){const{t:e}=tt(),n=se({list:[],total:0,page:1,pageSize:10}),a=se({page:1,pageSize:10,name:""}),d=T(),o=se({visible:!1,data:{name:"",menuIds:[]},title:"编辑管理员",type:"add",menuTree:[],rules:{name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:3,max:16,message:"长度在 2 到 20 个字符",trigger:"blur"}]}});Ae(()=>{s(),r()});const s=()=>_(this,null,function*(){const u=yield dt(a);u.code===200?(n.list=u.data.list,n.total=u.data.total,n.page=a.page,n.pageSize=a.pageSize):P.error(u.msg)}),r=()=>_(this,null,function*(){const u=yield ct();if(u.code===200){const k=nt(u.data,0);return o.menuTree=k,u.data}else return P.error(u.msg),[]}),h=()=>{o.visible=!0,o.type="add",o.title="新增角色",o.data={name:"",menuIds:[]},re(()=>{var u;(u=d.value)==null||u.setCheckedKeys([])})},y=u=>_(this,null,function*(){const k=yield rt(u);k.code===200?(o.visible=!0,o.type="edit",o.title="编辑角色",o.data=k.data,re(()=>{var S;(S=d.value)==null||S.setCheckedKeys(k.data.menuIds)})):P.error(k.msg)}),l=()=>_(this,null,function*(){if(o.type==="add"){const u=yield it(o.data);u.code===200?(P.success("新增角色成功"),o.visible=!1,s()):P.error(u.msg)}else if(o.type==="edit"){if(o.data.id===void 0)return;const u={id:o.data.id,name:o.data.name,menuIds:o.data.menuIds},k=yield lt(u);k.code===200?(P.success("编辑角色成功"),o.visible=!1,s()):P.error(k.msg)}}),c=()=>{var k;const u=(k=d.value)==null?void 0:k.getCheckedKeys();Array.isArray(u)&&(o.data.menuIds=u)},f=u=>{a.page=u},N=()=>{a.page=1,s()},C=()=>{a.page=1,a.name="",s()},E=u=>_(this,null,function*(){});return(u,k)=>{const S=at("permission");return w(),H("div",St,[v(g(be),{model:a},{default:b(()=>[v(g(ht),{gutter:24},{default:b(()=>[v(g(ue),{span:24},{default:b(()=>[Y((w(),B(g(W),{type:"primary",onClick:h},{default:b(()=>[O(L(g(e)("button.add")),1)]),_:1})),[[S,["system:role:add"]]])]),_:1}),v(g(ue),{xs:24,sm:12,md:8,lg:6,xl:6},{default:b(()=>[v(g(Z),{label:"角色名"},{default:b(()=>[v(g(Ee),{modelValue:a.name,"onUpdate:modelValue":k[0]||(k[0]=D=>a.name=D),placeholder:"请输入角色名"},null,8,["modelValue"])]),_:1})]),_:1}),v(g(ue),{xs:24,sm:12,md:8,lg:6,xl:6},{default:b(()=>[v(g(Z),null,{default:b(()=>[v(g(W),{type:"primary",onClick:N},{default:b(()=>[O(L(g(e)("button.submit")),1)]),_:1}),v(g(W),{onClick:C},{default:b(()=>[O(L(g(e)("button.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),v(g(ft),{data:n.list,border:"","default-expand-all":"","row-key":"id"},{default:b(()=>[v(g(G),{label:"ID",prop:"id",align:"center"}),v(g(G),{label:"角色名称",prop:"name",align:"center"}),v(g(G),{label:"创建时间",prop:"createdAt",align:"center"},{default:b(D=>[O(L(g(ve)(D.row.createdAt)),1)]),_:1}),v(g(G),{label:"更新时间",prop:"updatedAt",align:"center"},{default:b(D=>[O(L(g(ve)(D.row.updatedAt)),1)]),_:1}),v(g(G),{label:"操作",align:"center"},{default:b(D=>[Y((w(),B(g(W),{text:"",onClick:$=>y(D.row.id)},{default:b(()=>[O(L(g(e)("button.edit")),1)]),_:2},1032,["onClick"])),[[S,["system:role:edit"]]]),Y((w(),B(g(W),{type:"danger",text:"",onClick:$=>E(D.row.id)},{default:b(()=>[O(L(g(e)("button.delete")),1)]),_:2},1032,["onClick"])),[[S,["system:role:del"]]])]),_:1})]),_:1},8,["data"]),n.total>a.pageSize?(w(),B(g(st),{key:0,layout:"prev, pager, next",total:n.total,"page-size":a.pageSize,"current-page":a.page,onCurrentChange:f},null,8,["total","page-size","current-page"])):j("",!0),o.visible?(w(),B(g(pt),{key:1,modelValue:o.visible,"onUpdate:modelValue":k[2]||(k[2]=D=>o.visible=D),title:o.title,"append-to-body":""},{default:b(()=>[v(g(be),{ref:"dialogFormRef",model:o.data,rules:o.rules,"label-width":"100px"},{default:b(()=>[v(g(Z),{label:"角色名称",prop:"name",required:""},{default:b(()=>[v(g(Ee),{modelValue:o.data.name,"onUpdate:modelValue":k[1]||(k[1]=D=>o.data.name=D)},null,8,["modelValue"])]),_:1}),v(g(Z),{label:"权限树",prop:"title",required:""},{default:b(()=>[v(g(xt),{ref_key:"treeRef",ref:d,data:o.menuTree,"show-checkbox":"","node-key":"value","empty-text":"无权限","check-strictly":!0,onCheckChange:c},null,8,["data"])]),_:1}),v(g(Z),null,{default:b(()=>[v(g(W),{type:"primary",onClick:l},{default:b(()=>[O(L(g(e)("button.submit")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])):j("",!0)])}}});export{zt as default};
